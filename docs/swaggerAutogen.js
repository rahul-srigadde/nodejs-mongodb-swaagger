const swaggerAutogen = require("swagger-autogen")();
const tags = require("./schemas/endpoints");
const modelschema = require("./schemas/models");
const fs = require("fs");

const doc = {
  info: {
    version: "1.0.0",
    title: "My API",
    description:
      "Documentation automatically generated by the <b>swagger-autogen</b> module.",
  },
  host: "localhost:3000",
  basePath: "/api",
  schemes: ["http", "https"],
  consumes: ["application/json"],
  produces: ["application/json"],
  tags,
  securityDefinitions: {
    api_key: {
      type: "apiKey",
      name: "api_key",
      in: "header",
    },
  },
  definitions: modelschema,
};

const outputFile = "./swagger-output.json";
const endpointsFiles = loadFiles();

swaggerAutogen(outputFile, endpointsFiles, doc).then(() => {
  require("../index"); // Your project's root file
});

function loadFiles() {
  const testFolder = "./src/routes/resources/";
  let endpointsFiles = [];

  fs.readdirSync(testFolder).forEach((file) => {
    endpointsFiles.push(`${testFolder}${file}`);
  });
  return endpointsFiles;
}
